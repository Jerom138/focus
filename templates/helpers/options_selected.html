<!DOCTYPE html><html lang="en"><head><title>templates/helpers/options_selected</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../"><meta name="groc-document-path" content="templates/helpers/options_selected"><meta name="groc-project-path" content="lib/templates/helpers/options_selected.coffee"><meta name="groc-github-url" content="https://github.com/KleeGroup/focus"><link rel="stylesheet" type="text/css" media="all" href="../../assets/style.css"><script type="text/javascript" src="../../assets/behavior.js"></script><body><div id="meta"><div class="file-path"><a href="https://github.com/KleeGroup/focus/blob/master/lib/templates/helpers/options_selected.coffee">lib/templates/helpers/options_selected.coffee</a></div></div><div id="document"><div class="segment"><div class="code"><div class="wrapper">metadaBuilder = Fmk.Helpers.metadataBuilder<span class="hljs-comment"># require('./metadata_builder').metadataBuilder</span>
domains_definition = Fmk.Helpers.metadataBuilder.getDomains()
logger = <span class="hljs-keyword">new</span> Logger()

<span class="hljs-comment">#Generate a optionset selector. https://developer.mozilla.org/en-US/docs/Web/API/HTMLSelectElement</span>
Handlebars.registerHelper <span class="hljs-string">"options_selected"</span>, <span class="hljs-function"><span class="hljs-params">(property, options)</span> -&gt;</span>
  options = options <span class="hljs-keyword">or</span> {}
  opt = options.hash <span class="hljs-keyword">or</span> {}
  cssClass = <span class="hljs-keyword">if</span> opt.cssClass? <span class="hljs-keyword">then</span> opt.cssClass <span class="hljs-keyword">else</span> <span class="hljs-string">""</span>
  optName = <span class="hljs-keyword">if</span> opt.optName? <span class="hljs-keyword">then</span> <span class="hljs-string">"data-name='<span class="hljs-subst">#{opt.optName}</span>'"</span> <span class="hljs-keyword">else</span> <span class="hljs-string">""</span>
  optToTriggerName = <span class="hljs-keyword">if</span> opt.optToTriggerName? <span class="hljs-keyword">then</span> <span class="hljs-string">"data-opttotrigger-name='<span class="hljs-subst">#{opt.optToTriggerName}</span>'"</span> <span class="hljs-keyword">else</span> <span class="hljs-string">""</span>
  optToTriggerListKey = <span class="hljs-keyword">if</span> opt.optToTriggerListKey? <span class="hljs-keyword">then</span> <span class="hljs-string">"data-opttotrigger-listkey='<span class="hljs-subst">#{opt.optToTriggerListKey}</span>'"</span> <span class="hljs-keyword">else</span> <span class="hljs-string">""</span>
  optMapping = <span class="hljs-keyword">if</span> opt.optMapping? <span class="hljs-keyword">then</span> <span class="hljs-keyword">this</span>[opt.optMapping] <span class="hljs-keyword">else</span> <span class="hljs-literal">null</span>
  dataMapping = <span class="hljs-keyword">if</span> optMapping? <span class="hljs-keyword">then</span> <span class="hljs-string">"data-mapping=<span class="hljs-subst">#{optMapping}</span>"</span> <span class="hljs-keyword">else</span> <span class="hljs-string">""</span>
  list = <span class="hljs-keyword">this</span>[opt.listKey] <span class="hljs-keyword">or</span> []
  selected = <span class="hljs-keyword">this</span>[property] <span class="hljs-keyword">or</span> opt.selected <span class="hljs-keyword">or</span> <span class="hljs-literal">undefined</span>
  <span class="hljs-keyword">if</span>(opt.addDefault)
    list =[{<span class="hljs-attribute">id</span>: <span class="hljs-literal">undefined</span>, <span class="hljs-attribute">label</span>: <span class="hljs-string">''</span>}].concat(list)
  metadata = Fmk.Helpers.metadataBuilder.getMetadataForAttribute(<span class="hljs-keyword">this</span>,property)
  domain = Fmk.Helpers.metadataBuilder.getDomains()[metadata.domain] <span class="hljs-keyword">or</span> {}
  <span class="hljs-comment">#console.log "domain", domain</span>
  <span class="hljs-function"><span class="hljs-title">isRequired</span> = <span class="hljs-params">()</span>=&gt;</span>
    isDisplayRequired = <span class="hljs-literal">false</span>
    <span class="hljs-keyword">if</span> opt.isRequired?
      isDisplayRequired = opt.isRequired
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> metadata.required?
      isDisplayRequired = metadata.required
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> isDisplayRequired <span class="hljs-keyword">then</span> <span class="hljs-string">"&lt;span class='input-group-addon'&gt;*&lt;/span&gt;"</span> <span class="hljs-keyword">else</span> <span class="hljs-string">""</span>
  translationRoot = opt.translationRoot <span class="hljs-keyword">or</span> <span class="hljs-literal">undefined</span>
  isAtLine = opt.isAtLine <span class="hljs-keyword">or</span> <span class="hljs-literal">false</span>
  readonly = opt.readonly <span class="hljs-keyword">or</span> <span class="hljs-literal">false</span>
  readonly = <span class="hljs-keyword">if</span> readonly <span class="hljs-keyword">then</span> <span class="hljs-string">"disabled"</span> <span class="hljs-keyword">else</span> <span class="hljs-string">""</span>
  labelSizeValue = <span class="hljs-keyword">if</span> opt.isNoLabel <span class="hljs-keyword">then</span> <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> opt.labelSize <span class="hljs-keyword">then</span> opt.labelSize <span class="hljs-keyword">else</span> <span class="hljs-number">4</span>
  labelSize = <span class="hljs-string">"col-sm-<span class="hljs-subst">#{labelSizeValue}</span> col-md-<span class="hljs-subst">#{labelSizeValue}</span> col-lg-<span class="hljs-subst">#{labelSizeValue}</span>"</span>
  col = <span class="hljs-keyword">if</span> opt.col? <span class="hljs-keyword">then</span> Handlebars.helpers.col.call(<span class="hljs-keyword">this</span>, opt.col) <span class="hljs-keyword">else</span> <span class="hljs-string">""</span>
  
  <span class="hljs-function"><span class="hljs-title">inputSize</span> = <span class="hljs-params">()</span>=&gt;</span>
    <span class="hljs-comment">#When it's a checkbox from BootstrapSwitch the input size is equal to zero.</span>
    <span class="hljs-keyword">if</span> opt.containerCss
      inputSize = <span class="hljs-string">""</span>
    <span class="hljs-keyword">else</span>
      inputSizeValue = <span class="hljs-number">12</span> - labelSizeValue
      inputSize = opt.inputSize <span class="hljs-keyword">or</span> <span class="hljs-string">"col-sm-<span class="hljs-subst">#{inputSizeValue}</span> col-md-<span class="hljs-subst">#{inputSizeValue}</span> col-lg-<span class="hljs-subst">#{inputSizeValue}</span>"</span>
  <span class="hljs-comment">#Get the value of the transalated label.</span>
  <span class="hljs-comment">#Get the value of the transalated label.</span>
  <span class="hljs-function"><span class="hljs-title">translationKey</span> =<span class="hljs-params">()</span>=&gt;</span>
    translation = opt.translationKey <span class="hljs-keyword">or</span> metadata.label <span class="hljs-keyword">or</span> (<span class="hljs-string">"<span class="hljs-subst">#{<span class="hljs-keyword">this</span>[<span class="hljs-string">'modelName'</span>]}</span>.<span class="hljs-subst">#{property}</span>"</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">this</span>[<span class="hljs-string">'modelName'</span>]?) <span class="hljs-keyword">or</span> <span class="hljs-string">""</span>
    <span class="hljs-keyword">if</span> translationRoot?
      translation = ((<span class="hljs-keyword">if</span> (translationRoot?) <span class="hljs-keyword">and</span> <span class="hljs-keyword">typeof</span> translationRoot <span class="hljs-keyword">is</span> <span class="hljs-string">"string"</span> <span class="hljs-keyword">then</span> translationRoot + <span class="hljs-string">"."</span> <span class="hljs-keyword">else</span> <span class="hljs-string">""</span>)) + property
    
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span>(translation <span class="hljs-keyword">is</span> <span class="hljs-string">""</span>) <span class="hljs-keyword">then</span> <span class="hljs-string">""</span> <span class="hljs-keyword">else</span> i18n.t(translation)
  <span class="hljs-function"><span class="hljs-title">icon</span> = <span class="hljs-params">()</span>=&gt;</span>  
  <span class="hljs-comment">#&lt;span class='glyphicon glyphicon-#{opt.icon}'&gt;&lt;/span&gt;</span>
    <span class="hljs-keyword">if</span> opt.icon? <span class="hljs-keyword">then</span> <span class="hljs-string">"&lt;span class='input-group-addon'&gt;&lt;i class='fa fa-<span class="hljs-subst">#{opt.icon}</span> fa-fw'&gt;&lt;/i&gt; &lt;/span&gt;"</span> <span class="hljs-keyword">else</span> <span class="hljs-string">""</span>
    <span class="hljs-comment">#if opt.icon? then "&lt;span class='input-group-addon'&gt; &lt;span class='glyphicon glyphicon-#{opt.icon}'&gt;&lt;/span&gt;&lt;/span&gt;" else ""</span>
  isAddOnInput = <span class="hljs-literal">true</span> <span class="hljs-keyword">or</span> opt.icon? <span class="hljs-keyword">or</span> (opt.isRequired || metadata.required) <span class="hljs-keyword">is</span> <span class="hljs-literal">true</span>
   <span class="hljs-comment">#Deal with the label</span>
  <span class="hljs-function"><span class="hljs-title">label</span> = <span class="hljs-params">()</span>=&gt;</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> opt.isNoLabel?
      <span class="hljs-keyword">if</span> isAtLine
        <span class="hljs-string">"&lt;div class='row'&gt;&lt;label class='control-label for='<span class="hljs-subst">#{property}</span>'&gt; <span class="hljs-subst">#{translationKey()}</span> &lt;/label&gt;&lt;/div&gt;"</span>
      <span class="hljs-keyword">else</span>
        <span class="hljs-string">"&lt;label class='control-label <span class="hljs-subst">#{labelSize}</span>' for='<span class="hljs-subst">#{property}</span>'&gt; <span class="hljs-subst">#{translationKey()}</span> &lt;/label&gt;"</span> 
    <span class="hljs-keyword">else</span> <span class="hljs-string">""</span>
  <span class="hljs-comment">#Initialize the errors variables =&gt; Is there an error, if yes what is the message.</span>
  error = <span class="hljs-string">""</span>
  error = <span class="hljs-string">"has-error"</span> <span class="hljs-keyword">if</span> <span class="hljs-property">@errors</span>? <span class="hljs-keyword">and</span> <span class="hljs-property">@errors</span>[property]?
  errorValue = <span class="hljs-keyword">if</span> <span class="hljs-property">@errors</span>? <span class="hljs-keyword">and</span> <span class="hljs-property">@errors</span>[property]? <span class="hljs-keyword">then</span> i18n.t(<span class="hljs-property">@errors</span>[property]) <span class="hljs-keyword">else</span> <span class="hljs-string">""</span>
  <span class="hljs-comment">#Deal with error</span>
  <span class="hljs-function"><span class="hljs-title">errors</span> = <span class="hljs-params">()</span>=&gt;</span>
    <span class="hljs-keyword">if</span> error == <span class="hljs-string">"has-error"</span> <span class="hljs-keyword">then</span> <span class="hljs-string">"&lt;span class='<span class="hljs-subst">#{error}</span> help-inline pull-left' style='color:#b94a48'&gt; <span class="hljs-subst">#{errorValue }</span> &lt;/span&gt;"</span> <span class="hljs-keyword">else</span> <span class="hljs-string">""</span>
  jsonGiven = <span class="hljs-keyword">this</span>
  <span class="hljs-comment">#We define a small addOption function in order to add an option to the select.</span>
  <span class="hljs-function"><span class="hljs-title">addOption</span> = <span class="hljs-params">(elt)</span> -&gt;</span>
    id = elt.id <span class="hljs-keyword">or</span> elt.code
    prop = <span class="hljs-keyword">if</span> opt.labelProperty <span class="hljs-keyword">then</span> elt[opt.labelProperty] <span class="hljs-keyword">else</span> elt.label
    isSelected = <span class="hljs-keyword">if</span> selected? <span class="hljs-keyword">and</span> id? <span class="hljs-keyword">and</span> ((!_.isArray(selected) <span class="hljs-keyword">and</span> id.toString() <span class="hljs-keyword">is</span> selected.toString()) <span class="hljs-keyword">or</span> (_.isArray(selected) <span class="hljs-keyword">and</span> selected.indexOf(id.toString()) &gt; -<span class="hljs-number">1</span>)) <span class="hljs-keyword">then</span> <span class="hljs-string">"selected"</span> <span class="hljs-keyword">else</span> <span class="hljs-string">""</span>
    html+= <span class="hljs-string">"&lt;option value= '<span class="hljs-subst">#{id}</span>'  <span class="hljs-subst">#{isSelected}</span>&gt;<span class="hljs-subst">#{prop}</span>&lt;/option&gt;"</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>
  multiple = <span class="hljs-keyword">if</span> opt.isMultiple <span class="hljs-keyword">then</span> <span class="hljs-string">"multiple style='width:'resolve';'"</span> <span class="hljs-keyword">else</span> <span class="hljs-string">""</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Define </p></div></div><div class="code"><div class="wrapper">  <span class="hljs-function"><span class="hljs-title">emptyOption</span> = -&gt;</span>
    isRequiredWithValue = selected? <span class="hljs-keyword">and</span> ( isRequired() <span class="hljs-keyword">isnt</span> <span class="hljs-string">""</span>)
    <span class="hljs-keyword">if</span>((opt.isEmpty <span class="hljs-keyword">is</span> <span class="hljs-literal">true</span>) <span class="hljs-keyword">or</span> ((opt.isMultiple <span class="hljs-keyword">is</span> <span class="hljs-literal">true</span>) <span class="hljs-keyword">or</span> (isRequiredWithValue <span class="hljs-keyword">is</span> <span class="hljs-literal">true</span>)) <span class="hljs-keyword">and</span> (<span class="hljs-keyword">not</span> opt.isNotEmpty))
      <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">"&lt;option&gt;&lt;/option&gt;"</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Save the following information=&gt; Edit mode with a value and display required =&gt; No empty option.</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-comment">#return "&lt;option&gt;&lt;/option&gt;" if ((not isEditAndRequired) and (not opt.isNotEmpty)) and (not opt.isMultiple)</span>
  <span class="hljs-comment">#Initialize the html  </span>
  html = <span class="hljs-string">"&lt;div class='form-group <span class="hljs-subst">#{error}</span> <span class="hljs-subst">#{col}</span>'&gt;
            <span class="hljs-subst">#{label()}</span>
            &lt;div class='controls <span class="hljs-subst">#{inputSize()}</span>'&gt;
              &lt;div class='input-group '&gt;
                <span class="hljs-subst">#{icon()}</span>                
                &lt;select id='<span class="hljs-subst">#{property}</span>' data-name='<span class="hljs-subst">#{property}</span>' <span class="hljs-subst">#{multiple}</span> <span class="hljs-subst">#{readonly}</span> <span class="hljs-subst">#{optName}</span> <span class="hljs-subst">#{optToTriggerName}</span> <span class="hljs-subst">#{optToTriggerListKey}</span> <span class="hljs-subst">#{dataMapping}</span> class='form-control input-sm <span class="hljs-subst">#{cssClass}</span>'&gt;<span class="hljs-subst">#{emptyOption()}</span>"</span>
  <span class="hljs-comment">#add options foreach options in the list</span>
  addOption(elt) <span class="hljs-keyword">for</span> elt <span class="hljs-keyword">in</span> list
  html +=      <span class="hljs-string">"&lt;/select&gt;<span class="hljs-subst">#{isRequired()}</span> 
              &lt;/div&gt;
              <span class="hljs-subst">#{errors()}</span>
            &lt;/div&gt;
          &lt;/div&gt;"</span>  
  <span class="hljs-keyword">new</span> Handlebars.SafeString(html)</div></div></div></div></body></html>