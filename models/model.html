<!DOCTYPE html><html lang="en"><head><title>models/model</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="models/model"><meta name="groc-project-path" content="lib/models/model.coffee"><meta name="groc-github-url" content="https://github.com/KleeGroup/focus"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path"><a href="https://github.com/KleeGroup/focus/blob/master/lib/models/model.coffee">lib/models/model.coffee</a></div></div><div id="document"><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-function"><span class="hljs-params">((NS) -&gt;
  <span class="hljs-string">"use strict"</span></span></span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Filename: models/model.coffee</p></div></div><div class="code"><div class="wrapper">  NS = NS <span class="hljs-keyword">or</span> {}
  isInBrowser = <span class="hljs-keyword">typeof</span> <span class="hljs-built_in">module</span> <span class="hljs-keyword">is</span> <span class="hljs-string">'undefined'</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">typeof</span> <span class="hljs-built_in">window</span> <span class="hljs-keyword">isnt</span> <span class="hljs-string">'undefined'</span>
  metadataBuilder = <span class="hljs-keyword">if</span> isInBrowser <span class="hljs-keyword">then</span> NS.Helpers.metadataBuilder <span class="hljs-keyword">else</span> <span class="hljs-built_in">require</span>(<span class="hljs-string">"../helpers/metadata_builder"</span>).metadataBuilder</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Base class for all models. Define all transverses methods on the model.</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Model</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Backbone</span>.<span class="hljs-title">Model</span></span>
    <span class="hljs-attribute">defaultIfNew</span>: <span class="hljs-literal">undefined</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Initialize method of the model.</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-attribute">initialize</span>: <span class="hljs-function"><span class="hljs-params">(options)</span>-&gt;</span>
      options = options <span class="hljs-keyword">or</span> {}
      <span class="hljs-keyword">super</span> options
      <span class="hljs-property">@modelName</span> = options.modelName <span class="hljs-keyword">if</span> options.modelName?
      <span class="hljs-property">@processMetadatas</span>()
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.has(<span class="hljs-string">'id'</span>) <span class="hljs-keyword">and</span> <span class="hljs-keyword">this</span>.get(<span class="hljs-string">'id'</span>) <span class="hljs-keyword">is</span> <span class="hljs-string">'new'</span>)
        <span class="hljs-keyword">this</span>.unset(<span class="hljs-string">'id'</span>, {<span class="hljs-attribute">silent</span>: <span class="hljs-literal">true</span>})
        <span class="hljs-keyword">this</span>.set(<span class="hljs-string">'isNewModel'</span>, <span class="hljs-literal">true</span>, {<span class="hljs-attribute">silent</span>: <span class="hljs-literal">true</span>})
      <span class="hljs-keyword">else</span>
        <span class="hljs-keyword">this</span>.set(<span class="hljs-string">'isNewModel'</span>, <span class="hljs-literal">false</span>, {<span class="hljs-attribute">silent</span>: <span class="hljs-literal">true</span>})
      <span class="hljs-property">@savePrevious</span>()
      <span class="hljs-keyword">if</span>(<span class="hljs-property">@isNew</span>() <span class="hljs-keyword">and</span> <span class="hljs-property">@defaultIfNew</span>? )
        <span class="hljs-keyword">this</span>.set(<span class="hljs-property">@defaultIfNew</span>, { <span class="hljs-attribute">silent</span>: <span class="hljs-literal">true</span> })</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Process all the models metadatas, save theminto the model.</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-attribute">processMetadatas</span>:<span class="hljs-function"> -&gt;</span>
      <span class="hljs-keyword">this</span>.metadatas = metadataBuilder.getMetadatas(_.pick(<span class="hljs-keyword">this</span>, <span class="hljs-string">"modelName"</span>, <span class="hljs-string">"metadatas"</span>))</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Change the idAttribute depending on the metadatas.</p></div></div><div class="code"><div class="wrapper">      <span class="hljs-keyword">if</span> <span class="hljs-keyword">this</span>.metadatas? <span class="hljs-keyword">and</span> <span class="hljs-keyword">this</span>.metadatas.idAttribute?
        <span class="hljs-keyword">this</span>.idAttribute = metadatas.idAttribute <span class="hljs-comment"># Set the id attribute depending ont the metadatas.</span>
    <span class="hljs-comment">#Define a method in order to be able to quickly remove errors form the model.</span>
    <span class="hljs-attribute">unsetErrors</span>:<span class="hljs-function"><span class="hljs-params">(options)</span> -&gt;</span>
      options = options <span class="hljs-keyword">or</span> {}
      silent = options.silent <span class="hljs-keyword">or</span> <span class="hljs-literal">false</span>
      <span class="hljs-property">@unset</span>(<span class="hljs-string">'errors'</span>, {<span class="hljs-attribute">silent</span>: silent})
    <span class="hljs-comment">#Define a setErrors method in order to quickly be able to set Errors.</span>
    <span class="hljs-attribute">setErrors</span>:<span class="hljs-function"><span class="hljs-params">(errors)</span> -&gt;</span>
      <span class="hljs-property">@set</span>({<span class="hljs-string">'errors'</span>: errors}) <span class="hljs-keyword">if</span> errors?</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>The model name can be define.</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-attribute">modelName</span>: <span class="hljs-literal">undefined</span>
    <span class="hljs-attribute">toJSON</span>:<span class="hljs-function"> -&gt;</span>
      jsonModel = <span class="hljs-keyword">super</span>()
      jsonModel.cid = <span class="hljs-property">@cid</span>
      jsonModel.metadatas =  <span class="hljs-property">@metadatas</span>
      jsonModel.modelName =  <span class="hljs-property">@modelName</span> <span class="hljs-keyword">or</span> <span class="hljs-property">@get</span>(<span class="hljs-string">'modelName'</span>)
      <span class="hljs-keyword">return</span> jsonModel
      </div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Return a json to Save.</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-attribute">toSaveJSON</span>:<span class="hljs-function"> -&gt;</span>
      json = Backbone.Model.prototype.toJSON.call(@)
      <span class="hljs-keyword">return</span> _.omit(json, <span class="hljs-string">'isNew'</span>, <span class="hljs-string">'metadatas'</span>, <span class="hljs-string">'cid'</span>)</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Return true if the model is inside a collection.</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-attribute">isInCollection</span>:<span class="hljs-function"> -&gt;</span>
      <span class="hljs-keyword">return</span> <span class="hljs-property">@collection</span>?</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Save the previous attributes into the model.</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-attribute">savePrevious</span>:<span class="hljs-function"> -&gt;</span>
      <span class="hljs-property">@perviousModelValues</span> = <span class="hljs-property">@toSaveJSON</span>()</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Restore the previous attributes in the model.</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-attribute">restorePrevious</span>: <span class="hljs-function"><span class="hljs-params">(options)</span>-&gt;</span>
      options = options <span class="hljs-keyword">or</span> {}
      options.silent = options.isSilent <span class="hljs-keyword">or</span> <span class="hljs-literal">false</span>
      <span class="hljs-property">@clear</span>({<span class="hljs-attribute">silent</span>: <span class="hljs-literal">true</span>})
      <span class="hljs-property">@set</span>(<span class="hljs-property">@perviousModelValues</span>, options)
    <span class="hljs-attribute">isDifferent</span>:<span class="hljs-function"> -&gt;</span>
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">not</span> _.isEqual <span class="hljs-property">@perviousModelValues</span>, <span class="hljs-property">@toSaveJSON</span>()
  <span class="hljs-keyword">if</span> isInBrowser
    NS.Models = NS.Models <span class="hljs-keyword">or</span> {}
    NS.Models.Model = Model
  <span class="hljs-keyword">else</span>
    <span class="hljs-built_in">module</span>.<span class="hljs-built_in">exports</span> = Model
)(<span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> <span class="hljs-built_in">module</span> <span class="hljs-keyword">is</span> <span class="hljs-string">'undefined'</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">typeof</span> <span class="hljs-built_in">window</span> <span class="hljs-keyword">isnt</span> <span class="hljs-string">'undefined'</span> <span class="hljs-keyword">then</span> <span class="hljs-built_in">window</span>.Fmk <span class="hljs-keyword">else</span> <span class="hljs-built_in">module</span>.<span class="hljs-built_in">exports</span>)</div></div></div></div></body></html>